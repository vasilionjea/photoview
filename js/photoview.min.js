/*! PhotoView.js - v0.0.2 - 2016-05-20
 * http://istocode.github.io/photoview
 * Copyright (c) 2016 Billy Onjea.
 * Licensed under the MIT license.
 */ !function(a){"use strict";a.app=a.app||{},a.app._={toArray:function(a){return Array.prototype.slice.call(a)},extend:function(){var a=this.toArray(arguments),b=a.shift(),c=0,d=a.length;for(c;d>c;c+=1)Object.keys(a[c]).forEach(function(d){b[d]||(b[d]=a[c][d])});return b},$:function(b,c){return(c||a.document).querySelector(b)},$$:function(b,c){return(c||a.document).querySelectorAll(b)},applyPatterns:function(a,b){return a.replace(/\{(\w+)\}/g,function(a,c){return void 0!==b[c]?b[c]:a})}}}(this),function(a){"use strict";a.app=a.app||{},a.app.ajax={get:function(b){var c,d=b.url;if(b.cache===!1&&(d=d+(/\?/.test(d)?"&":"?")+ +new Date),!a.XMLHttpRequest)throw new Error("Your browser doesn't support the XMLHttpRequest object!");c=new XMLHttpRequest,c.addEventListener("readystatechange",function(){4===c.readyState&&(200===c.status?b.success(c.responseText,c.status,c.statusText):b.error(c.status,c.statusText))},!1),c.open("GET",d,!0),c.send(null)}}}(this),function(a){"use strict";function b(a,b){var c=f.applyPatterns(h.pattern.slice(),a);return c+="large"===b?h.largeSuffix:h.smallSuffix}function c(a){var b=i.pattern+i.methods[a.method]+i.format;return f.applyPatterns(b,a)}function d(a){this.settings=f.extend({},a,i.defaultParams)}var e=a.app,f=e._,g=e.ajax,h={pattern:"https://farm{farm}.staticflickr.com/{server}/{id}_{secret}",smallSuffix:"_q.jpg",largeSuffix:"_z.jpg"},i={pattern:"https://api.flickr.com/services/rest/?method={method}&api_key={api_key}&per_page={per_page}",format:"&format=json&nojsoncallback=1",methods:{"flickr.photos.search":"&text={text}","flickr.interestingness.getList":""},defaultParams:{api_key:"",method:"flickr.interestingness.getList",per_page:20}};d.prototype={constructor:d,fetch:function(a){a=f.extend({},a,this.settings),g.get({url:c(a),success:this._onFetchSuccess.bind(this,a.success),error:this._onFetchError.bind(this,a.error)})},_onFetchSuccess:function(a,b,c){var d=JSON.parse(b);d&&d.photos&&Array.isArray(d.photos.photo)&&this._setPhotos(d.photos.photo),a&&a(this.getPhotos())},_onFetchError:function(a,b){a&&a(b)},_setPhotos:function(a){this.photos=a.map(function(a,c){return{index:c,id:a.id,title:a.title,smallUrl:b(a,"small"),largeUrl:b(a,"large")}})},getPhotos:function(){var a=[];return this.photos&&this.photos.length&&(a=this.photos),a},getPhoto:function(a){return this.photos[a]}},e.Flickr=d}(this),function(a){"use strict";function b(){var a="";return a+='<li class="photo" data-id="{id}" data-index="{index}">',a+='<figure><img src="{smallUrl}" alt="{title}"></figure>',a+="</li>"}function c(){var a='<div class="photo-view-backdrop" aria-hidden="true"></div>';return a+='<aside class="photo-view">',a+='<div class="inner">',a+="<figure></figure>",a+='<button class="nav-btn prev" title="Previous photo"></button>',a+='<button class="nav-btn next" title="Next photo"></button>',a+="</div>",a+="</aside>"}function d(){var a="";return a+='<img class="large-photo" src="{largeUrl}" alt="{title}">',a+="<figcaption>{title}</figcaption>"}function e(a){this.settings=a,this.service=this.settings.service,this._currentIndex=null,this.ui.container=g.$(this.settings.container),this.templates.smallPhoto=b(),this.templates.photoView=c(),this._attachEvents()}var f=a.app,g=f._;e.prototype={constructor:e,templates:{smallPhoto:null,photoView:null},ui:{container:null},load:function(a){var b=a||{};b.success=this._render.bind(this),this.service.fetch(b)},_buildHtml:function(a){var b=this.templates.photoView,c=this;return b+='<ul class="photo-grid">',a.forEach(function(a){var d=c.templates.smallPhoto.slice();b+=g.applyPatterns(d,a)}),b+="</ul>"},_render:function(a){this.ui.container.insertAdjacentHTML("beforeend",this._buildHtml(a)),this.ui.backdrop=g.$(".photo-view-backdrop",this.ui.container),this.ui.photoView=g.$(".photo-view",this.ui.container),this.ui.largePhoto=g.$("figure",this.ui.photoView)},_attachEvents:function(){this.ui.container.addEventListener("click",function(a){var b,c=a.target,d=c.parentNode.parentNode;return c.classList.contains("large-photo")?void this.close():c.classList.contains("nav-btn")?(c.classList.contains("prev")&&this.prev(),void(c.classList.contains("next")&&this.next())):void(d.classList.contains("photo")&&(b=this.service.getPhoto(parseInt(d.dataset.index,10)),b&&this.open(b)))}.bind(this),!1)},_show:function(a){a&&(this.ui.largePhoto.innerHTML=g.applyPatterns(d(),a),this._currentIndex=a.index)},open:function(a){this._show(a),document.body.classList.add("photo-view-open"),this.ui.backdrop.classList.add("visible"),this.ui.photoView.classList.add("visible")},close:function(){this.ui.largePhoto.innerHTML="",document.body.classList.remove("photo-view-open"),this.ui.backdrop.classList.remove("visible"),this.ui.photoView.classList.remove("visible")},prev:function(){this._show(this.service.getPhoto(this._currentIndex-1))},next:function(){this._show(this.service.getPhoto(this._currentIndex+1))}},f.PhotoView=e}(this);