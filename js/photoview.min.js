/*! PhotoView.js - v0.0.1 - 2016-05-19
 * http://istocode.github.io/photoview
 * Copyright (c) 2016 Billy Onjea.
 * Licensed under the MIT license.
 */ !function(a){"use strict";a.app=a.app||{},a.app._={toArray:function(a){return Array.prototype.slice.call(a)},extend:function(){var a=this.toArray(arguments),b=a.shift(),c=0,d=a.length;for(c;d>c;c+=1)Object.keys(a[c]).forEach(function(d){b[d]||(b[d]=a[c][d])});return b},$:function(b,c){return(c||a.document).querySelector(b)},$$:function(b,c){return(c||a.document).querySelectorAll(b)},applyPatterns:function(a,b){return a.replace(/\{(\w+)\}/g,function(a,c){return void 0!==b[c]?b[c]:a})}}}(this),function(a){"use strict";a.app=a.app||{},a.app.ajax={fetch:function(b){var c,d=b.url;if(b.cache===!1&&(d=d+(/\?/.test(d)?"&":"?")+ +new Date),!a.XMLHttpRequest)throw new Error("Your browser doesn't support the XMLHttpRequest object!");c=new XMLHttpRequest,c.addEventListener("readystatechange",function(){4===c.readyState&&(200===c.status?b.success(c.responseText,c.status,c.statusText):b.error(c.status,c.statusText))},!1),c.open("GET",d,!0),c.send(null)}}}(this),function(a){"use strict";function b(a){this.settings=d.extend({},a,j),this.url=d.applyPatterns(i.slice(),this.settings)}var c=a.app,d=c._,e=c.ajax,f="https://farm{farm}.staticflickr.com/{server}/{id}_{secret}",g="_q.jpg",h="_z.jpg",i="https://api.flickr.com/services/rest/?method={method}&api_key={api_key}&text={text}&per_page={per_page}&format=json&nojsoncallback=1",j={api_key:"",method:"flickr.photos.search",per_page:20};b.prototype={constructor:b,search:function(a){var b=d.applyPatterns(this.url.slice(),{text:a.term});e.fetch({url:b,success:this._onFetchSuccess.bind(this,a.success),error:this._onFetchError.bind(this,a.error)})},_onFetchSuccess:function(a,b,c){var d=JSON.parse(b);d&&d.photos&&Array.isArray(d.photos.photo)&&this._setPhotos(d.photos.photo),a(this.getPhotos())},_onFetchError:function(a,b){},_createPhotoUrl:function(a,b){var c=d.applyPatterns(f.slice(),a);return c+="large"===b?h:g},_setPhotos:function(a){var b=this;this.photos=a.map(function(a,c){return{index:c,id:a.id,title:a.title,smallUrl:b._createPhotoUrl(a,"small"),largeUrl:b._createPhotoUrl(a,"large")}})},getPhotos:function(){var a=[];return this.photos&&this.photos.length&&(a=this.photos),a},getPhoto:function(a){return this.photos[a]}},c.Flickr=b}(this),function(a){"use strict";function b(){var a="";return a+='<li class="photo" data-id="{id}" data-index="{index}">',a+='<figure><img src="{smallUrl}" alt="{title}"></figure>',a+="</li>"}function c(){var a='<div class="photo-view-backdrop hidden" aria-hidden="true"></div>';return a+='<aside class="photo-view hidden">',a+='<div class="inner">',a+="<figure></figure>",a+='<button class="prev" title="Previous photo"></button>',a+='<button class="next" title="Next photo"></button>',a+="</div>",a+="</aside>"}function d(){var a="";return a+='<img class="large-photo" src="{largeUrl}" alt="{title}">',a+="<figcaption>{title}</figcaption>"}function e(a){this.settings=a,this.service=this.settings.service,this.ui.container=g.$(this.settings.container),this.templates.smallPhoto=b(),this.templates.photoView=c(),this._attachEvents()}var f=a.app,g=f._;e.prototype={constructor:e,templates:{smallPhoto:null,photoView:null},ui:{container:null},load:function(a){this.service.search({term:a,success:this._onLoad.bind(this)})},_onLoad:function(a){this._render(a)},_buildHtml:function(a){var b=this.templates.photoView,c=this;return b+='<ul class="photo-grid">',a.forEach(function(a){var d=c.templates.smallPhoto.slice();b+=g.applyPatterns(d,a)}),b+="</ul>"},_render:function(a){this.ui.container.insertAdjacentHTML("beforeend",this._buildHtml(a)),this.ui.photoViewBackdrop=g.$(".photo-view-backdrop",this.ui.container),this.ui.photoView=g.$(".photo-view",this.ui.container),this.ui.largePhoto=g.$("figure",this.ui.photoView)},_attachEvents:function(){this.ui.container.addEventListener("click",function(a){var b,c=a.target.parentNode.parentNode;return a.target.classList.contains("large-photo")?void this.close():void(c.classList.contains("photo")&&(b=this.service.getPhoto(parseInt(c.dataset.index,10)),b&&this.open(b)))}.bind(this),!1)},open:function(a){this.ui.largePhoto.innerHTML=g.applyPatterns(d(),a),document.body.classList.add("photo-view-open"),this.ui.photoViewBackdrop.classList.remove("hidden"),this.ui.photoView.classList.remove("hidden")},close:function(){this.ui.largePhoto.innerHTML="",document.body.classList.remove("photo-view-open"),this.ui.photoViewBackdrop.classList.add("hidden"),this.ui.photoView.classList.add("hidden")}},f.PhotoView=e}(this);